# ğŸ“… Daily Log - 2026-02-14 (Shanba)

## ğŸ¯ Bugungi Maqsad

Loyihani tozalab, local va deployda bir xil xatosiz ishlashi va `pnpm run dev:both` ishlashini taâ€™minlash.

---

## âœ… Bajarilgan Ishlar

### 1ï¸âƒ£ Cache va muhit tozalash

- Root, `frontend` va `backend` dagi **node_modules** oâ€˜chirildi.
- **frontend/.next**, **backend/dist**, **.jest-cache**, **coverage** tozalandi.
- **pnpm install** qayta ishlatildi, barcha dependencyâ€™lar oâ€˜rnatildi.
- **Prisma Client** postinstall orqali avtomatik generate qilindi.

**Natija:** Toza muhit, qayta oâ€˜rnatish xatosiz yakunlandi.

---

### 2ï¸âƒ£ Backend pnpm filter tuzatildi

**Muammo:** `pnpm run dev:both` da backend ishlamas edi â€” "No projects matched the filters".

**Sabab:** Root `package.json` da `--filter backend` ishlatilgan, lekin backend paket nomi **zor-pizza-backend** (`backend/package.json` â†’ `"name": "zor-pizza-backend"`).

**Yechim:** Root `package.json` da barcha backend skriptlarda filter **zor-pizza-backend** ga oâ€˜zgartirildi:

- `dev:backend` â†’ `pnpm --filter zor-pizza-backend dev`
- `test:backend` â†’ `pnpm --filter zor-pizza-backend test`
- `test:backend:watch` â†’ `pnpm --filter zor-pizza-backend test:watch`
- `test:backend:coverage` â†’ `pnpm --filter zor-pizza-backend test:coverage`

**Oâ€˜zgargan fayl:** `package.json`

---

### 3ï¸âƒ£ Frontend dev server xatosi (uv_interface_addresses)

**Muammo:** Next.js ishga tushganda `uv_interface_addresses` tarmoq interfeyslari xatosi (baâ€™zi muhitlarda/sandboxda).

**Yechim:** `frontend/package.json` da dev skriptga **host** qoâ€˜shildi:

- `"dev": "next dev -p 3000 -H 127.0.0.1"` â€” server faqat localhostda ishlaydi, tarmoq interfeyslariga bogâ€˜liq emas.

**Oâ€˜zgargan fayl:** `frontend/package.json`

---

### 4ï¸âƒ£ Next.js workspace (turbopack) ogohlantirishi

**Muammo:** "Next.js inferred your workspace root..." va bir nechta lockfile haqida ogohlantirish.

**Yechim:** `frontend/next.config.ts` da **turbopack.root** oâ€˜rnatildi:

- `turbopack: { root: '..' }` â€” monorepo ildizi toâ€˜gâ€˜ri tanlanadi.

**Oâ€˜zgargan fayl:** `frontend/next.config.ts`

---

### 5ï¸âƒ£ Local frontend â†’ production API (CORS / Network Error)

**Muammo:** Frontend **127.0.0.1:3000** da ochilganda categories/products/deals soâ€˜rovlari **production** backend ga ketardi (`https://zo-rpizza-production.up.railway.app`). Natija: CORS blok, "Error fetching categories", "Network Error", 500.

**Sabab:** `frontend/lib/apiBaseUrl.ts` da faqat **localhost** tekshirilardi, **127.0.0.1** emas. Frontend `-H 127.0.0.1` bilan ishlaganda `window.location.hostname === '127.0.0.1'` boâ€˜ladi, shuning uchun local hisoblanmay, production URL ishlatilardi.

**Yechim:**

1. **127.0.0.1** ham local deb qabul qilindi: `isLocalHost(host)` â€” `localhost` va `127.0.0.1`.
2. Brauzerda **localhost** yoki **127.0.0.1** da ochilganda API manzil **http://localhost:5001** (local backend).
3. SSR (development): `NODE_ENV === 'development'` va `NEXT_PUBLIC_API_URL` berilmagan boâ€˜lsa, server-side ham **http://localhost:5001** ishlatiladi.

**Oâ€˜zgargan fayl:** `frontend/lib/apiBaseUrl.ts`

- `LOCAL_API = 'http://localhost:5001'`
- `isLocalHost(host)` funksiyasi
- `getApiBaseUrl()` da `window.location.hostname` uchun `isLocalHost(...)` ishlatiladi
- `API_BASE_URL` (SSR) developmentda local backend ishlatadi

**Natija:** Local da frontend va backend bir xil (localhost:5001) ishlaydi, CORS va "Error fetching categories" ketadi.

---

## ğŸ“‹ Qisqacha oâ€˜zgarishlar

| Fayl | Oâ€˜zgarish |
|------|-----------|
| `package.json` | Backend skriptlar: `--filter zor-pizza-backend` |
| `frontend/package.json` | `next dev -p 3000 -H 127.0.0.1` |
| `frontend/next.config.ts` | `turbopack: { root: '..' }` |
| `frontend/lib/apiBaseUrl.ts` | 127.0.0.1 = local, local backend URL, SSR dev fix |

---

## ğŸš€ Ishga tushirish

```bash
# Barcha cache tozalash (kerak boâ€˜lsa)
rm -rf node_modules frontend/node_modules backend/node_modules frontend/.next backend/dist
pnpm install

# Frontend + backend birga
pnpm run dev:both
```

- **Frontend:** http://127.0.0.1:3000 yoki http://localhost:3000  
- **Backend:** http://localhost:5001  

Local da frontend avtomatik **http://localhost:5001** ga soâ€˜rov yuboradi. Deployda `NEXT_PUBLIC_API_URL` yoki production fallback ishlatiladi.

---

## ğŸ¯ Ertaga (2026-02-15) davom etish

- Feature ishlariga qaytish (FEATURES_IMPLEMENTATION.md boâ€˜yicha).
- Kerak boâ€˜lsa: test order, GPS tracking, order flow test.
- ERTAGA.md dagi "Ertaga qilish kerak" boâ€˜limi yangilangan.

---

_Last Updated: 2026-02-14_  
_Status: âœ… Local dev:both ishlaydi, CORS/API URL tuzatildi_
